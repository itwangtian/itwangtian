---
title: immerï¼šä¼˜é›…æ“ä½œreactæ•°æ®çŠ¶æ€ï¼Œå‘Šåˆ«ç¹çå…‹éš†æ‹·è´
urlname: dv8t85khggaglosv
date: "2023-08-23 05:19:55"
updated: "2023-08-23 22:39:51"
---

æ–‡ç« é¦–å‘å…¬ä¼—å· ğŸ‘‰[ç¨‹åºå‘˜ç‹å¤©](https://img-cdn.dslcv.com/wt_gzh.png)ğŸ‘ˆ æ¬¢è¿å…³æ³¨

# å‰è¨€

Immer æ˜¯ä¸€ä¸ªç”¨äºç®€åŒ– JavaScript çŠ¶æ€ç®¡ç†çš„åº“ï¼Œä»¥æ›´æ–¹ä¾¿åœ°æ›´æ–°å’Œæ“ä½œä¸å¯å˜æ•°æ®

å¯ä»¥è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š

1.  `ä¸å¯å˜çŠ¶æ€æ›´æ–°`ï¼šReact æ¨å´‡ä½¿ç”¨ä¸å¯å˜ï¼ˆImmutableï¼‰çš„æ•°æ®æ¥ç®¡ç†ç»„ä»¶çš„çŠ¶æ€ã€‚
    :::tips
    ã€Immutable ä¸å¯å˜å¯¹è±¡ã€‘
    ä¸ç›´æ¥ä¿®æ”¹çŠ¶æ€æˆ–å±æ€§å¯¹è±¡ï¼Œè€Œæ˜¯åˆ›å»ºæ–°çš„å¯¹è±¡æ¥ä»£è¡¨æ”¹å˜åçš„çŠ¶æ€ã€‚
    :::

Immer ä½¿å¾—åœ¨ React ä¸­ä½¿ç”¨ä¸å¯å˜æ•°æ®æ›´åŠ å®¹æ˜“ï¼Œé€šè¿‡æä¾›ç®€æ´çš„ API å’Œç›´è§‚çš„è¯­æ³•ï¼Œä»¥å¯å˜çš„æ–¹å¼æ›´æ–°ä¸å¯å˜æ•°æ®ã€‚

2.  `çŠ¶æ€æ›´æ–°çš„ç®€æ´æ€§`ï¼šReact çš„ä¼ ç»Ÿæ–¹å¼æ˜¯é€šè¿‡ä½¿ç”¨ `setState` æ–¹æ³•æ›´æ–°çŠ¶æ€ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºæ–°çš„çŠ¶æ€å¯¹è±¡æˆ–æ•°ç»„ï¼Œå¹¶è¿›è¡Œæ·±åº¦å…‹éš†ã€‚è€Œä½¿ç”¨ Immerï¼Œå¯ä»¥é€šè¿‡ç›´æ¥åœ¨åŸå§‹çŠ¶æ€ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œä»¥ä¸€ç§å¯å˜çš„æ–¹å¼æ›´æ–°çŠ¶æ€ã€‚

React ä¸­ä½¿ç”¨ Immer ï¼Œå¯ä»¥é¿å…æ‰‹åŠ¨ç¼–å†™æ·±åº¦å…‹éš†ã€åˆå¹¶å¯¹è±¡æˆ–æ•°ç»„çš„ä»£ç ï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒæ•°æ®çš„ä¸å¯å˜æ€§ï¼Œæ–¹ä¾¿è¿›è¡ŒçŠ¶æ€ç®¡ç†å’Œè¿½è¸ªå˜æ›´ã€‚

# react ç»„ä»¶ä½¿ç”¨ immer

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Immer çš„ React ç»„ä»¶ç¤ºä¾‹ï¼š

```jsx
import React from "react";
import { produce } from "immer";

class Counter extends React.Component {
  state = {
    count: 0,
  };

  increment = () => {
    this.setState(
      produce((draft) => {
        draft.count += 1;
      })
    );
  };

  render() {
    return (
      <div>
        <p>Count: {this.state.count}</p>
        <button onClick={this.increment}>Increment</button>
      </div>
    );
  }
}

export default Counter;
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `produce` å‡½æ•°å°†çŠ¶æ€æ›´æ–°çš„é€»è¾‘æ”¾åœ¨ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œç„¶åå°†å›è°ƒå‡½æ•°ä¼ é€’ç»™ `setState`ã€‚Immer ä¼šåœ¨å›è°ƒå‡½æ•°ä¸­æä¾›ä¸€ä¸ªåä¸º `draft` çš„è‰ç¨¿å¯¹è±¡ï¼Œ

æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹è¯¥å¯¹è±¡è¿›è¡Œæ›´æ”¹ï¼Œè€Œä¸ç”¨æ‹…å¿ƒåŸå§‹å¯¹è±¡è¢«ä¿®æ”¹ã€‚Immer ä¼šæ ¹æ®æˆ‘ä»¬çš„æ›´æ”¹ç”Ÿæˆä¸€ä¸ªæ–°çš„ä¸å¯å˜å¯¹è±¡ï¼Œå¹¶å°†å…¶ä½œä¸ºæ–°çš„çŠ¶æ€è¿›è¡Œæ›´æ–°ã€‚

# redux ä¸­ä½¿ç”¨ immer

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä½¿ç”¨ Immer ç»“åˆ Redux çš„ç¤ºä¾‹ï¼š

```javascript
import { createStore } from "redux";
import produce from "immer";

// åˆå§‹çŠ¶æ€
const initialState = {
  count: 0,
};

// reducer
const reducer = (state = initialState, action) => {
  return produce(state, (draft) => {
    switch (action.type) {
      case "INCREMENT":
        draft.count += 1;
        break;
      case "DECREMENT":
        draft.count -= 1;
        break;
      default:
        break;
    }
  });
};

// åˆ›å»º store
const store = createStore(reducer);

export default store;
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ Redux çš„ reducer ä¸­ä½¿ç”¨ `produce` å‡½æ•°æ¥æ›´æ”¹çŠ¶æ€ã€‚å®ƒæ¥æ”¶å½“å‰çŠ¶æ€ `state` å’Œè¡¨ç¤ºè¦è¿›è¡Œçš„æ›´æ”¹æ“ä½œçš„å›è°ƒå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¸­å¯¹ `draft` å¯¹è±¡è¿›è¡Œæ›´æ”¹ï¼ŒImmer ä¼šè‡ªåŠ¨å¤„ç†çŠ¶æ€çš„æ›´æ–°ã€‚

# æ€»ç»“

åœ¨ä½¿ç”¨ React ç»„ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `produce` å‡½æ•°æ¥æ›´æ–°çŠ¶æ€ï¼Œè€Œåœ¨ä½¿ç”¨ Redux æ—¶ï¼Œå¯ä»¥åœ¨ reducer ä¸­ä½¿ç”¨ `produce` å‡½æ•°æ¥è¿›è¡ŒçŠ¶æ€æ›´æ”¹æ“ä½œã€‚è¿™æ ·å¯ä»¥é¿å…æ‰‹åŠ¨ç¼–å†™ä¸å¿…è¦çš„å…‹éš†å’Œåˆå¹¶ä»£ç ï¼Œå¹¶ä¸”ä½¿æˆ‘ä»¬çš„ä»£ç æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚
