---
title: webhooks è‡ªåŠ¨éƒ¨ç½²gité¡¹ç›®
urlname: hgdvvg24f38gsvcp
date: "2023-09-17 13:19:07"
updated: "2023-09-17 19:39:25"
---

> âŒ ç»è¿‡ä¸æ–­å°è¯•ï¼Œæœæ–­æ”¾å¼ƒ webhoooksï¼ä¸æ˜¯è¸©å‘å¤ªå¤šï¼Œè€Œæ˜¯æœ€ç»ˆé…å¥½åæ‰§è¡Œå¤ªè€—æ—¶ã€‚
> ğŸ’¡ è‡ªåŠ¨éƒ¨ç½²ï¼Œæœ¬è´¨æ˜¯åœ¨æœåŠ¡å™¨æ‰§è¡Œ git clone ï¼Œå› å—æœåŠ¡å™¨èµ„èµ„æºé™åˆ¶ã€æ­¤è¿‡ç¨‹ä¼šéå¸¸è€—æ—¶ï¼Œæˆ‘ 20 å¤šå…†çš„ä»“åº“ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦åŠä¸ªå°æ—¶ã€‚
> âœ”ï¸ è¿‡ç¨‹å¤ªæ…¢è¿˜æµªè´¹æœåŠ¡å™¨å®½åº¦ï¼Œè¿˜ä¸å¦‚æœ¬åœ°å†™ä¸ªè„šæœ¬ä¸Šä¼ ç®—äº†

:::success
ğŸ”¥ å¯¹ webhooks ä¸åˆšå…´è¶£å¯ç›´æ¥çœ‹æœ€åä¸€ç« èŠ‚ï¼Œé€šè¿‡`ssh2-sftp-client` æ¨¡å—å®ç°ä¸Šä¼ æœåŠ¡å™¨
:::

# webhoooks è‡ªåŠ¨éƒ¨ç½² git é¡¹ç›®

æœ‰ä»€ä¹ˆç”¨ï¼Ÿ
æ›´ç›´è§‚ç‚¹è®²ï¼Œæœ‰äº† webhooksï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œæ— éœ€æ¯æ¬¡æ‰‹åŠ¨ä¸Šä¼ æœåŠ¡å™¨å•¦
gitee å’Œ github ä¸­éƒ½æœ‰æ­¤åŠŸèƒ½ 1.è‡ªåŠ¨åŒ– shell è„šæœ¬ 2.æœåŠ¡ç«¯å®ç° 3.é…ç½® github webhooks

å®å¡”
é…ç½®ç¯å¢ƒ
å®å¡”é»˜è®¤æ˜¯å®‰è£…å¥½ git çš„
é…ç½®å…¬é’¥
ç”Ÿæˆ Git ç”Ÿäº§ç¯å¢ƒä¸‹çš„å…¬é’¥çš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š

```
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```

è¿™ä¸ªå‘½ä»¤å°†ç”Ÿæˆä¸€ä¸ª RSA ç±»å‹çš„ SSH å¯†é’¥å¯¹ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç§é’¥å’Œä¸€ä¸ªå…¬é’¥ã€‚è¯·æ³¨æ„æ›¿æ¢ "your_email@example.com" ä¸ºä½ è‡ªå·±çš„ç”µå­é‚®ä»¶åœ°å€ã€‚
**å›è½¦ä¸‰æ¬¡**
ç”Ÿæˆçš„å¯†é’¥å¯¹é»˜è®¤å­˜å‚¨åœ¨ç”¨æˆ·çš„ ~/.ssh ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸º id_rsaï¼ˆç§é’¥ï¼‰å’Œ id_rsa.pubï¼ˆå…¬é’¥ï¼‰ã€‚

ç”Ÿæˆå…¬é’¥åï¼Œä½ å¯ä»¥å°†å…¬é’¥å†…å®¹å¤åˆ¶å¹¶æ·»åŠ åˆ° Git æ‰˜ç®¡æœåŠ¡ï¼ˆå¦‚ GitHubã€GitLab æˆ– Bitbucketï¼‰çš„è´¦æˆ·è®¾ç½®ä¸­ï¼Œä»¥ä¾¿åœ¨è¿›è¡Œè¿œç¨‹æ“ä½œæ—¶è¿›è¡Œèº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ã€‚
è¿™é‡Œæ·»åŠ åˆ° github ä¸­
é¦–æ¬¡éœ€é…ç½® git
åœ¨å®å¡”é¢æ¿çš„ç»ˆç«¯è®¾ç½® git

```
git config --global user.name "17638567073@163.com"
git config --global user.email "17638567073@163.com"
git config --global credential.helper store //ä¼šç”Ÿæˆ.gitconfig çš„æ–‡ä»¶
cat .gitconfig   //å¦‚æœæŠ¥é”™: No such file or directoryï¼Œå°±ç”¨ä¸‹ä¸€è¡Œçš„ä»£ç 
cat ~/.gitconfig  //æ˜¾ç¤ºå†…å®¹
```

# node å®ç°é¡¹ç›®-è‡ªåŠ¨éƒ¨ç½²

## ssh2-sftp-client

ssh2-sftp-client æ¨¡å—æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Node.js ç¯å¢ƒä¸­è¿›è¡Œ SSH æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆSFTPï¼‰æ“ä½œçš„åº“
ä»¥ä½¿ç”¨è¿™ä¸ªæ¨¡å—æ¥å®ç°è¿œç¨‹æ–‡ä»¶çš„ä¸Šä¼ ã€ä¸‹è½½æˆ–å…¶ä»–æ–‡ä»¶æ“ä½œä»»åŠ¡ã€‚

> SSH æ–‡ä»¶ä¸Šä¼ é€‚ç”¨äºé€šè¿‡ SSH åè®®åœ¨**æœ¬åœ°è®¡ç®—æœºå’Œè¿œç¨‹æœåŠ¡å™¨**ä¹‹é—´å»ºç«‹å®‰å…¨è¿æ¥è¿›è¡Œæ–‡ä»¶ä¼ è¾“

**å®Œæ•´ä¸Šä¼ ä»£ç **

```javascript
// ssh2-sftp-client äº²æµ‹å¥½ç”¨ï¼Œå®Œå…¨æ²¡æ¯›ç—…ï¼
let Client = require("ssh2-sftp-client");
function put(localPath, romotePath) {
  let sftp = new Client();
  sftp
    .connect({
      host: "xxx", // æœåŠ¡å™¨ IP
      port: "22",
      username: "xxx", // æœåŠ¡å™¨ç™»å½•ç”¨æˆ·å
      password: "xxx", // æœåŠ¡å™¨ç™»å½•å¯†ç 
    })
    .then(() => {
      // ä¸Šä¼ æ–‡ä»¶
      // return sftp.fastPut(localPath, romotePath);
      console.log("ä¸Šä¼ æ–‡ä»¶ä¸­");
      // ä¸‹è½½æ–‡ä»¶
      return sftp.uploadDir(localPath, romotePath);
    })
    .then((data) => {
      // console.log(localPath + "ä¸Šä¼ å®Œæˆ");
      console.log(data, "ä¸Šä¼ å®Œæˆ");
      sftp.end();
    })
    .catch((err) => {
      console.log(err, "catch error");
    });
}

let srcPath = "/www/wwwroot/itwangtian.com",
  // localPath = path.join(__dirname, 'test.txt'),
  romotePath = "./src/.vuepress/dist";

// ä¸Šä¼ æ–‡ä»¶
// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶çš„æœ¬åœ°è·¯å¾„ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯æœåŠ¡å™¨å­˜æ”¾çš„åœ°å€
// put(localPath, romotePath);
// ä¸‹è½½æ–‡ä»¶
// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦ä¸‹è½½çš„æ–‡ä»¶åœ¨æœåŠ¡å™¨å­˜æ”¾çš„åœ°å€ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯æœ¬åœ°å­˜æ”¾çš„è·¯å¾„
put(romotePath, srcPath);
```

## npm æ‰§è¡Œå¤šä¸ªå‘½ä»¤è¡Œ

## åœºæ™¯

è¿™ä¸¤å¤©ç”¨ vuepres æ­å»ºçŸ¥è¯†åº“åšå®¢ï¼Œæ¯æ¬¡éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œéƒ½éœ€è¦æ‰§è¡Œå¤šä¸ªå‘½ä»¤è¡Œï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š

1. `npm run buld`
2. `npm run upbt (è¿è¡Œsslä¸Šä¼ è„šæœ¬)`

åœ¨ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨å‰ï¼Œè¿˜éœ€æ‰‹åŠ¨æ‰“åŒ…é¡¹ç›®ï¼Œè™½ç„¶è¯´å¤šæ‰§è¡Œä¸€ä¸ªæ­¥éª¤ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜æ¥è¯´ï¼Œæœ€å¤§çš„å…´è¶£å°±æ˜¯å°†é‡å¤çš„äº‹æƒ…è‡ªåŠ¨åŒ–ã€‚
æ€ä¹ˆå®ç°å‘¢ï¼Ÿ
æ¨èä½¿ç”¨ `npm-run-all`

## npm-run-all

npm-run-all æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œç”¨äºåœ¨ package.json çš„ scripts ä¸­å¹¶è¡Œæˆ–é¡ºåºæ‰§è¡Œå¤šä¸ªå‘½ä»¤ã€‚å®ƒæä¾›äº†çµæ´»çš„å‘½ä»¤ç»„åˆå’Œæ‰§è¡Œæ–¹å¼ã€‚

### åŸºæœ¬ä½¿ç”¨

å…ˆå®‰è£… npm-run-all

```powershell
npm install -g npm-run-all
```

å’±ä»¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¥ä½¿ç”¨ npm-run-allï¼š

1. é¦–å…ˆï¼Œåœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸‹ï¼Œç¡®ä¿ä½ å·²ç»æœ‰ä¸€ä¸ª package.json æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯·å…ˆä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ package.json æ–‡ä»¶ï¼š

```powershell
npm init
```

2. åœ¨ package.json æ–‡ä»¶ä¸­çš„ scripts éƒ¨åˆ†ï¼Œé…ç½®ä½ è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ä½ å¯ä»¥ä½¿ç”¨ npm-run-all çš„å‘½ä»¤æ ¼å¼ï¼Œå¦‚ä¸‹ï¼š

```powershell
{
  "scripts": {
    "command1": "your-command-1",
      "command2": "your-command-2",
      "build": "npm-run-all command1 command2"
  }
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œcommand1 å’Œ command2 åˆ†åˆ«ä»£è¡¨ä½ è¦æ‰§è¡Œçš„ä¸¤ä¸ªå‘½ä»¤ï¼Œè€Œ build åˆ™æ˜¯ä¸€ä¸ªåŒ…è£…å‘½ä»¤ï¼Œç”¨äºé¡ºåºæ‰§è¡Œ command1 å’Œ command2ã€‚

3. æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥æ‰“å¼€ç»ˆç«¯å¹¶åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
npm run build
```

è¿™ä¼šè§¦å‘ npm æ‰§è¡Œ package.json ä¸­çš„ build å‘½ä»¤ï¼Œå³ npm-run-all command1 command2ã€‚æ­¤æ—¶ï¼Œnpm-run-all å°†æŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œ command1 å’Œ command2ã€‚

### æ›´å¤šç”¨æ³•

- `--parallel`ï¼šå¹¶è¡Œè¿è¡Œ npm è„šæœ¬ã€‚å¯ä»¥å°†å¤šä¸ªè„šæœ¬å‘½ä»¤ä»¥ç©ºæ ¼åˆ†éš”ä¼ é€’ç»™è¯¥å‚æ•°ï¼Œnpm-run-all å°†åŒæ—¶è¿è¡Œå®ƒä»¬ã€‚ç¤ºä¾‹ï¼šnpm-run-all --parallel script1 script2 script3
- `--serial`ï¼šæŒ‰é¡ºåºè¿è¡Œ npm è„šæœ¬ã€‚å¯ä»¥å°†å¤šä¸ªè„šæœ¬å‘½ä»¤ä»¥ç©ºæ ¼åˆ†éš”ä¼ é€’ç»™è¯¥å‚æ•°ï¼Œnpm-run-all å°†æŒ‰ç…§é¡ºåºè¿è¡Œå®ƒä»¬ã€‚ç¤ºä¾‹ï¼šnpm-run-all --serial script1 script2 script3
- `--continue-on-error`ï¼šå³ä½¿å‰ä¸€ä¸ªè„šæœ¬å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œä¹Ÿç»§ç»­æ‰§è¡Œåç»­çš„è„šæœ¬ã€‚ç¤ºä¾‹ï¼šnpm-run-all --parallel --continue-on-error script1 script2
- `--aggregate-output`ï¼šå°†æ‰€æœ‰è„šæœ¬çš„è¾“å‡ºåˆå¹¶åˆ°ä¸€ä¸ªç»ˆç«¯ä¸­æ˜¾ç¤ºã€‚ç¤ºä¾‹ï¼šnpm-run-all --serial --aggregate-output script1 script2 script3
