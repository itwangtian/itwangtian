---
title: ã€Œtokenæ–¹æ¡ˆæŒ‡å—ã€å‰åç«¯é‰´æƒ-è¶…æ—¶æœªæ“ä½œç™»å‡º
urlname: ueopfvai6y6du4ac
date: "2023-08-19 14:59:11"
updated: "2023-08-25 23:23:27"
---

å½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªéœ€è¦èº«ä»½éªŒè¯çš„ç½‘ç«™æˆ–åº”ç”¨æ—¶ï¼Œé€šå¸¸éœ€è¦æä¾›ç”¨æˆ·åå’Œå¯†ç æ¥éªŒè¯èº«ä»½ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹å¼å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å¯†ç å¯èƒ½ä¼šè¢«æ³„éœ²æˆ–è¢«çŒœæµ‹å‡ºæ¥ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ç§ç§°ä¸º"token é‰´æƒ"çš„èº«ä»½éªŒè¯æœºåˆ¶ã€‚

Token é‰´æƒæ˜¯ä¸€ç§åŸºäºä»¤ç‰Œçš„èº«ä»½éªŒè¯æ–¹å¼ã€‚ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡å™¨ç”Ÿæˆå”¯ä¸€ä»¤ç‰Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯åœ¨åç»­è¯·æ±‚ä¸­æºå¸¦ä»¤ç‰Œä½œä¸ºèº«ä»½å‡­è¯ã€‚

æœåŠ¡å™¨éªŒè¯ä»¤ç‰Œï¼Œç¡®å®šç”¨æˆ·èº«ä»½å’Œæƒé™ã€‚ä»¤ç‰Œä¸å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œå‡è½»è´Ÿæ‹…ã€‚ä»¤ç‰Œå¯è®¾ç½®æœ‰æ•ˆæœŸï¼Œå¢åŠ å®‰å…¨æ€§ã€‚ä»¤ç‰Œå¯åŒ…å«é¢å¤–ä¿¡æ¯ï¼Œæ–¹ä¾¿æƒé™æ§åˆ¶ã€‚

ä¼˜åŠ¿åœ¨äºç®€å•ã€å®‰å…¨ã€å¯æ‰©å±•ã€‚ä¸ä¾èµ–ç”¨æˆ·åå¯†ç ï¼Œå‡å°‘å¯†ç æ³„éœ²é£é™©ã€‚å¯å®ç°å•ç‚¹ç™»å½•å’Œè·¨ç³»ç»Ÿèº«ä»½éªŒè¯ã€‚å¯é€šè¿‡åŠ å¯†å’Œç­¾åå¢åŠ å®‰å…¨æ€§ã€‚

## token å’Œ jsonwebtoken æµç¨‹å›¾

token -æ¥å£è®¿é—®å‡­è¯![](https://gyg-bawei-zg4-2103b.oss-cn-beijing.aliyuncs.com/3afca19611725d4df57137367b2cb5fc.webp)
ğŸ’¡jwtï¼ˆé‰´æƒå¸¸ç”¨æ–¹æ¡ˆï¼‰
![IMG_4169.JPG](https://gyg-bawei-zg4-2103b.oss-cn-beijing.aliyuncs.com/d297c2030dd23a666a263301aaa6343b.jpeg)

## æ— æ„Ÿåˆ·æ–° token å¤„ç†æ–¹æ¡ˆ

### å®šä¹‰ä¸¤ä¸ª token

å•ç‚¹ç™»å½•

> ä¸»ç«™ç»´æŠ¤è‡ªå·±çš„ refresh-tokenï¼Œæœ‰æ•ˆæœŸè¾ƒé•¿ï¼Œæ¯æ¬¡ token è¿‡æœŸåå¯ä»¥ç”¨ refresh-token ç»™è‡ªå·±ç»­å‘½è¯·æ±‚æ–°çš„ tokenï¼Œä»ä¸»ç«™è·³è½¬åˆ°å­ç«™ï¼Œæˆ–è€…ä¸»ç«™æˆæƒå»å…¶ä»–é¡µé¢ï¼Œéƒ½æ˜¯ç»™å…¶ä»–é¡µé¢ tokenï¼Œtoken çš„æœ‰æ•ˆæœŸè¾ƒçŸ­ï¼Œè¿‡æœŸäº†å°±å¾—é‡æ–°æˆæƒï¼Œæ‰€ä»¥é€šè¿‡ token å’Œ refresh-token å°±å¯ä»¥åšåˆ°ç›¸å¯¹å®‰å…¨çš„å•ç‚¹ç™»é™†æˆ–è€…æˆæƒï¼Œå› ä¸ºä»–ä»¬ä¸¤ä¸ªçš„å¤±æ•ˆå®Œå…¨ä¸åŒã€‚

- token_refresh( åˆ·æ–°ä¸šåŠ¡ token çš„è®¿é—®å‡­è¯)
- accessï¼ˆä¸šåŠ¡ tokenï¼‰

ä¸ºäº†å®‰å…¨æœŸé—´ï¼Œæ¯ä¸ª access token æœ‰æ•ˆæ—¶é—´é€šå¸¸ä¸èƒ½è®¾å¤ªé•¿ï¼Œè€Œ refresh token å°±æ˜¯ä¸ºäº†å»¶é•¿ access token çš„æœ‰æ•ˆæ—¶é—´çš„ï¼Œä¸€å¼€å§‹å°± refresh tokenï¼Œé‚£æ˜æ˜¾ä¸ç¬¦åˆ
![](https://gyg-bawei-zg4-2103b.oss-cn-beijing.aliyuncs.com/4764bd028d00d2a05c11a91ffe508756.webp)

### å®šä¹‰ä¸€ä¸ª token

åœ¨è¯·æ±‚å“åº”æ‹¦æˆªå™¨ä¸­æ‹¦æˆªï¼Œåˆ¤æ–­ token è¿”å›è¿‡æœŸåï¼Œè°ƒç”¨åˆ·æ–° token æ¥å£
å‚è€ƒé“¾æ¥
[https://juejin.cn/post/6854573219119104014](https://juejin.cn/post/6854573219119104014)
[https://juejin.cn/post/6983582201690456071#heading-5](https://juejin.cn/post/6983582201690456071#heading-5)

### é—®é¢˜

- [é—®é¢˜ä¸€ï¼šå¦‚ä½•é˜²æ­¢å¤šæ¬¡åˆ·æ–° token](https://juejin.cn/post/6983582201690456071#heading-4)
- [é—®é¢˜äºŒï¼šåŒæ—¶å‘èµ·ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šçš„è¯·](https://juejin.cn/post/6983582201690456071#heading-5)

## cookie-ssetion vs token

- sestionId éœ€è¦å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¢åŠ äº†æŸ¥è¯¢çš„å¼€é”€
- token æ˜¯ä¸ªæ— çŠ¶æ€çš„ï¼Œæ— éœ€å­˜å‚¨ï¼Œç¼ºé™· token æœ‰æ•ˆæœŸå†…é”€æ¯

## æ¥å£-è¶…æ—¶æœªæ“ä½œç™»å‡º

åœ¨ token é‰´æƒçš„åŠŸèƒ½åŸºç¡€ä¸Šï¼Œå®ç°æ¥å£è¶…æ—¶æœªäº¤äº’ï¼Œåˆ™è´¦å·é€€å‡ºã€‚
**é˜²è¸©å‘æ— ç”¨ç‰ˆ**ä»¥ä¸‹æ€è·¯æ˜¯æˆ‘åœ¨**æœªæ¥è§¦æ— æ„Ÿåˆ·æ–°æ–¹æ¡ˆçš„æ„æ·«ç‰ˆï¼Œå›¾ä¸€ä¹å°±è¡Œå•¦**
**å‰ç«¯å®ç°ï¼ˆæœ‰é£é™©-å®¹æ˜“è¢«ç¯¡æ”¹ï¼‰**
åœ¨å‰ç«¯è¯·æ±‚æ‹¦æˆªä¸­å®ç°

1. é¦–æ¬¡è¯·æ±‚æˆåŠŸåæœ¬åœ°å­˜å‚¨æ—¶é—´ï¼Œä¸‹æ¬¡è¯·æ±‚å“åº”å‰è¿›è¡Œæ—¶é—´æ ¡éªŒã€‚
2. å½“å‰æ—¶é—´ä¸æœ¬åœ°æ—¶é—´æ ¡éªŒï¼Œæœªè¶…æ—¶ç»§ç»­è¯·æ±‚ï¼Œè¶…æ—¶åˆ™è·³è½¬ç™»å½•é¡µã€‚

**åç«¯ node å®ç°**
ç”¨æˆ·æ“ä½œä»»æ„ä¸€ä¸ªæ¥å£æ—¶ï¼Œåå°è¿›è¡Œæ ¡éªŒã€‚

1. åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸæ—¶ï¼Œå°†ç”¨æˆ·çš„æœ€åæ“ä½œæ—¶é—´è®°å½•åœ¨ä¼šè¯ä¸­æˆ–å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚
2. å¯¹äºæ¯ä¸ªè¯·æ±‚ï¼Œéƒ½æ›´æ–°ç”¨æˆ·çš„æœ€åæ“ä½œæ—¶é—´ã€‚
3. è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨æˆ–å®šæ—¶ä»»åŠ¡ï¼Œåœ¨ä¸€å®šæ—¶é—´é—´éš”å†…æ£€æŸ¥ç”¨æˆ·æœ€åæ“ä½œæ—¶é—´ä¸å½“å‰æ—¶é—´çš„å·®å€¼ã€‚å¦‚æœè¶…è¿‡äº†è®¾å®šçš„æ—¶é—´é˜ˆå€¼ï¼Œåˆ™æ‰§è¡Œé€€å‡ºæ“ä½œã€‚

### ç¬¬äºŒç‰ˆï¼ˆé€šç”¨æ–¹æ¡ˆ ğŸ’¡ï¼‰

ä½¿ç”¨åŒ token å®ç°æ— æ„Ÿåˆ·æ–°ç™»å½• ğŸ”„ï¼Œæ— éœ€å†æ£€æµ‹æ¥å£è¶…æ—¶æœªè®¿é—®ã€å®ç°ç³»ç»Ÿç™»å‡ºåŠŸèƒ½ã€‚

å› ä¸ºåœ¨è¯·æ±‚æ‹¦æˆªå™¨ä¸­ï¼Œç›‘å¬æ¥å£ 401 çŠ¶æ€ï¼ˆtoken å¤±æ•ˆï¼‰å»è°ƒç”¨åˆ·æ–° token æ¥å£ï¼Œå¦‚æœ refash_toke ä¹Ÿå¤±æ•ˆï¼Œè¯´æ˜åœ¨è§„å®šæ—¶é—´å†…æœªè®¿é—®ã€åˆ™ç™»å‡ºç³»ç»Ÿ

## å‰ç«¯-è¶…æ—¶æœªæ“ä½œç™»å‡º

ç”¨æˆ·é•¿æ—¶é—´æœªæ“ä½œé¡µé¢ï¼Œè¿”å›ç™»å½•
æ¯éš” 30s å»æ£€æŸ¥ä¸€ä¸‹ç”¨æˆ·æ˜¯å¦è¿‡äº† 30 åˆ†é’Ÿæœªæ“ä½œé¡µé¢ã€‚
æ³¨æ„äº‹é¡¹ï¼šï¼éœ€è¦è€ƒè™‘åŠæ—¶é”€æ¯å®šæ—¶å™¨

```typescript
// å¼•å…¥è·¯ç”±å’Œstorageå·¥å…·å‡½æ•°
import storage from "@/utils/storage";
import router from "@/common/router";

let lastTime = new Date().getTime();
let currentTime = new Date().getTime();
let timeOut = 30 * 60 * 1000; //è®¾ç½®è¶…æ—¶æ—¶é—´: 30åˆ†é’Ÿ

window.onload = function () {
  window.document.onmousedown = function () {
    stroage.setItem("lastTime", new Date().getTime());
  };
};

function checkTimeout() {
  currentTime = new Date().getTime(); //æ›´æ–°å½“å‰æ—¶é—´
  lastTime = stroage.getItem("lastTime");

  if (currentTime - lastTime > timeOut) {
    //åˆ¤æ–­æ˜¯å¦è¶…æ—¶

    // æ¸…é™¤storageçš„æ•°æ®(ç™»é™†ä¿¡æ¯å’Œtoken)
    storage.clear();
    // è·³åˆ°ç™»é™†é¡µ
    if (router.currentRouter.name == "login") return; // å½“å‰å·²ç»æ˜¯ç™»é™†é¡µæ—¶ä¸åšè·³è½¬
    router.push({ name: "login" });
  }
}

export default function () {
  /* å®šæ—¶å™¨ é—´éš”30ç§’æ£€æµ‹æ˜¯å¦é•¿æ—¶é—´æœªæ“ä½œé¡µé¢ */
  window.setInterval(checkTimeout, 30000);
}
```
