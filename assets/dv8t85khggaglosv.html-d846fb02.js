import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as e,o as p,c as o,a as s,b as n,d as c,e as l}from"./app-24e2a4f8.js";const i={},u={href:"https://img-cdn.dslcv.com/wt_gzh.png",target:"_blank",rel:"noopener noreferrer"},r=l(`<h1 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a> å‰è¨€</h1><p>Immer æ˜¯ä¸€ä¸ªç”¨äºç®€åŒ– JavaScript çŠ¶æ€ç®¡ç†çš„åº“ï¼Œä»¥æ›´æ–¹ä¾¿åœ°æ›´æ–°å’Œæ“ä½œä¸å¯å˜æ•°æ®</p><p>å¯ä»¥è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li><code>ä¸å¯å˜çŠ¶æ€æ›´æ–°</code>ï¼šReact æ¨å´‡ä½¿ç”¨ä¸å¯å˜ï¼ˆImmutableï¼‰çš„æ•°æ®æ¥ç®¡ç†ç»„ä»¶çš„çŠ¶æ€ã€‚<br> :::tips<br> ã€Immutable ä¸å¯å˜å¯¹è±¡ã€‘<br> ä¸ç›´æ¥ä¿®æ”¹çŠ¶æ€æˆ–å±æ€§å¯¹è±¡ï¼Œè€Œæ˜¯åˆ›å»ºæ–°çš„å¯¹è±¡æ¥ä»£è¡¨æ”¹å˜åçš„çŠ¶æ€ã€‚<br> :::</li></ol><p>Immer ä½¿å¾—åœ¨ React ä¸­ä½¿ç”¨ä¸å¯å˜æ•°æ®æ›´åŠ å®¹æ˜“ï¼Œé€šè¿‡æä¾›ç®€æ´çš„ API å’Œç›´è§‚çš„è¯­æ³•ï¼Œä»¥å¯å˜çš„æ–¹å¼æ›´æ–°ä¸å¯å˜æ•°æ®ã€‚</p><ol start="2"><li><code>çŠ¶æ€æ›´æ–°çš„ç®€æ´æ€§</code>ï¼šReact çš„ä¼ ç»Ÿæ–¹å¼æ˜¯é€šè¿‡ä½¿ç”¨ <code>setState</code> æ–¹æ³•æ›´æ–°çŠ¶æ€ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºæ–°çš„çŠ¶æ€å¯¹è±¡æˆ–æ•°ç»„ï¼Œå¹¶è¿›è¡Œæ·±åº¦å…‹éš†ã€‚è€Œä½¿ç”¨ Immerï¼Œå¯ä»¥é€šè¿‡ç›´æ¥åœ¨åŸå§‹çŠ¶æ€ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œä»¥ä¸€ç§å¯å˜çš„æ–¹å¼æ›´æ–°çŠ¶æ€ã€‚</li></ol><p>React ä¸­ä½¿ç”¨ Immer ï¼Œå¯ä»¥é¿å…æ‰‹åŠ¨ç¼–å†™æ·±åº¦å…‹éš†ã€åˆå¹¶å¯¹è±¡æˆ–æ•°ç»„çš„ä»£ç ï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒæ•°æ®çš„ä¸å¯å˜æ€§ï¼Œæ–¹ä¾¿è¿›è¡ŒçŠ¶æ€ç®¡ç†å’Œè¿½è¸ªå˜æ›´ã€‚</p><h1 id="react-ç»„ä»¶ä½¿ç”¨-immer" tabindex="-1"><a class="header-anchor" href="#react-ç»„ä»¶ä½¿ç”¨-immer" aria-hidden="true">#</a> react ç»„ä»¶ä½¿ç”¨ immer</h1><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Immer çš„ React ç»„ä»¶ç¤ºä¾‹ï¼š</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> produce <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;immer&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>
      <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        draft<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Count: </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>increment<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Counter<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>produce</code> å‡½æ•°å°†çŠ¶æ€æ›´æ–°çš„é€»è¾‘æ”¾åœ¨ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œç„¶åå°†å›è°ƒå‡½æ•°ä¼ é€’ç»™ <code>setState</code>ã€‚Immer ä¼šåœ¨å›è°ƒå‡½æ•°ä¸­æä¾›ä¸€ä¸ªåä¸º <code>draft</code> çš„è‰ç¨¿å¯¹è±¡ï¼Œ</p><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹è¯¥å¯¹è±¡è¿›è¡Œæ›´æ”¹ï¼Œè€Œä¸ç”¨æ‹…å¿ƒåŸå§‹å¯¹è±¡è¢«ä¿®æ”¹ã€‚Immer ä¼šæ ¹æ®æˆ‘ä»¬çš„æ›´æ”¹ç”Ÿæˆä¸€ä¸ªæ–°çš„ä¸å¯å˜å¯¹è±¡ï¼Œå¹¶å°†å…¶ä½œä¸ºæ–°çš„çŠ¶æ€è¿›è¡Œæ›´æ–°ã€‚</p><h1 id="redux-ä¸­ä½¿ç”¨-immer" tabindex="-1"><a class="header-anchor" href="#redux-ä¸­ä½¿ç”¨-immer" aria-hidden="true">#</a> redux ä¸­ä½¿ç”¨ immer</h1><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä½¿ç”¨ Immer ç»“åˆ Redux çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> produce <span class="token keyword">from</span> <span class="token string">&quot;immer&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// åˆå§‹çŠ¶æ€</span>
<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// reducer</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">produce</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&quot;INCREMENT&quot;</span><span class="token operator">:</span>
        draft<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&quot;DECREMENT&quot;</span><span class="token operator">:</span>
        draft<span class="token punctuation">.</span>count <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»º store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ Redux çš„ reducer ä¸­ä½¿ç”¨ <code>produce</code> å‡½æ•°æ¥æ›´æ”¹çŠ¶æ€ã€‚å®ƒæ¥æ”¶å½“å‰çŠ¶æ€ <code>state</code> å’Œè¡¨ç¤ºè¦è¿›è¡Œçš„æ›´æ”¹æ“ä½œçš„å›è°ƒå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¸­å¯¹ <code>draft</code> å¯¹è±¡è¿›è¡Œæ›´æ”¹ï¼ŒImmer ä¼šè‡ªåŠ¨å¤„ç†çŠ¶æ€çš„æ›´æ–°ã€‚</p><h1 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h1><p>åœ¨ä½¿ç”¨ React ç»„ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>produce</code> å‡½æ•°æ¥æ›´æ–°çŠ¶æ€ï¼Œè€Œåœ¨ä½¿ç”¨ Redux æ—¶ï¼Œå¯ä»¥åœ¨ reducer ä¸­ä½¿ç”¨ <code>produce</code> å‡½æ•°æ¥è¿›è¡ŒçŠ¶æ€æ›´æ”¹æ“ä½œã€‚è¿™æ ·å¯ä»¥é¿å…æ‰‹åŠ¨ç¼–å†™ä¸å¿…è¦çš„å…‹éš†å’Œåˆå¹¶ä»£ç ï¼Œå¹¶ä¸”ä½¿æˆ‘ä»¬çš„ä»£ç æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚</p>`,18);function d(k,m){const a=e("ExternalLinkIcon");return p(),o("div",null,[s("p",null,[n("æ–‡ç« é¦–å‘å…¬ä¼—å· ğŸ‘‰"),s("a",u,[n("ç¨‹åºå‘˜ç‹å¤©"),c(a)]),n("ğŸ‘ˆ æ¬¢è¿å…³æ³¨")]),r])}const g=t(i,[["render",d],["__file","dv8t85khggaglosv.html.vue"]]);export{g as default};
